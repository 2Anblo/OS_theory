5.1输入输出概念
设备分类（按传送单位分类）
	1.字符型设备——一般速度较慢（低/中速）
	2.块设备
设备分类（按速度分类）
	1.低速设备：键盘鼠标
	2.中速设备：打印机，扫描仪
	3.高速设备：磁盘
5.2输入输出控制
设备控制器：1.接收CPU指令
		   2.连接具体设备
设备控制器的任务：
1.数据转换（将顺序输入的bit流转换为字节块）
2.改错
3.让数据在内存中可用
设备控制器对寄存器的编址方式：
1.独立编址——端口地址（分离内存和IO设备的地址，内存用mov指令，IO用in/out指令）
2.统一编址——将IO设备与内存的地址连成一片，使得内存和IO设备可以共用相同的指令
3.混合编址——数据传输使用通用指令，控制IO设备使用单独指令
CPU/内存/IO设备的总线结构：
1.单总线结构（ISA）
2.双总线结构，加入一条高带宽总线，使得CPU和内存之间可以通过高带宽总线进行数据传输。

I/O控制方式：
1.程序控制（查询）方式——串行
例如内核的打印系统调用，CPU忙等。
2.中断控制方式——并行
当中断控制器给CPU发出中断信号后，CPU保存当前任务，响应中断。
3.DMA——并行，中断次数少
	CPU配置DMA中的源地址/目标地址，Count（取多大数据）
	DMA通过总线向IO设备搬运数据
	当Count减为0时，DMA给CPU发出中断信号。
	CPU通过总线激活内存某地址，将数据传输。
4.通道方式
通道处理器（本身也是IO连接系统总线）下面挂载多个IO控制器，IO控制器之间还有IO总线

5.3软件层次
5.3.1输入输出软件层
IO软件层设计的目标
	1.设备独立性
	2.设备命名唯一
	3.IO软件对错误处理
	4.同步/异步传输
	5.缓冲（平衡快慢速度）
	6.共享设备（磁盘）/独享设备（磁带机/打印机）
IO软件层次：（用户请求调用设备从上至下不经过中断处理层，硬件调用返回时调用中断处理层）
	用户空间IO软件层（用户态）
	设备独立IO软件层（内核态）
	设备驱动
	中断处理

用户空间IO软件层
	库函数
	Spooling系统
	Spooling把独享设备改为共享设备，在外存上开辟输入输出井，把进程1到n的内容存储到输入输出井的缓冲区中，谁先输入完谁先打印，进行虚拟的设备分配。而在调用IO打印进程来进行真实的打印过程。

设备独立层（一个系统只有一个）
	是设备驱动层之上的一个接口，负责缓冲，错误处理，分配和释放设备，提供相应的存储空间。
	设备独立层可以统一设备接口，设备驱动按照统一标准设计。
	在用户空间开辟缓冲区/在内核空间开辟缓冲区（双缓冲区）

设备分配
	设备独立层有系统设备表（System Device Table, SDT，一个OS只有一张）。
	设备驱动层有设备控制表（Device Control Table，DCT，每个设备拥有一张）。
	在设备控制表下还存在控制器控制表（Cotroller Control Table）和通道控制表（Channel Control Table）由他们来对硬件进行实际操作。

5.3.2设备管理
系统设备表（SDT，System Device Table）
	一个系统一张
	SDT表项：
		DCT指针：指向相应设备的DCT
		设备使用进程标识
		DCT信息
设备控制表（DCT，Device Control Table）
	一个设备一张
	DCT表项：
		设备标识：用来区分不同设备
		设备类型：块设备/字符设备
		设备配置：设备的IO地址
		设备状态：工作/空闲
		等待队列：等待使用该设备的进程队列
		IO控制器指针：指向该设备的控制器
控制器控制表（COCT， COntroler Control Table）
	每个设备控制器一张
通道控制表（CHCT，CHannel Control Table）
	每个通道一张

设备分配原则
合理有效地使用外设，提高设备利用率。
相关属性：
	独享设备：打印机等；
	共享设备：磁盘、网卡等；
分配方式：
	静态分配：在进程创建时分配，退出时释放。
		不会出现死锁；
		设备利用率不高
	动态分配（共享）：在进程执行过程中根据需要分配，使用结束后释放；
		会出现死锁
		提高设备利用率
分配策略：
先来先服务FCFS
基于优先级

中断处理层
1.中断处理通常隐藏在后台
2.中断程序有固定工作
3.中断结束后恢复现场

中断与访管指令（trap）不同
trap是进程自己调用的系统调用，也称为内中断。可在指令之间产生。
中断也称为外中断，一般在指令最后响应，由硬件激活。

5.4磁盘
5.4.1磁盘的硬件
盘片（Platters）：
盘片可以是单面或双面，双面盘片的两面都可以存储数据。

磁头（Heads）：
每个盘片面都有一个对应的磁头，双面盘片则有两个磁头。

磁道（Tracks）：
磁道是盘片上用于存储数据的同心圆环区域。
每个磁道可以进一步划分为扇区。

柱面（Cylinders）：
柱面是指所有盘片上相同半径的磁道组成的圆柱形区域。
在所有盘片上，相同柱面的磁道是相互对应的，即它们位于读写臂的同一直线上。

扇区（Sectors）：
扇区是磁道上最小的可寻址存储单位，是数据存储的基本单元。
扇区通常包含512字节或更多的数据，以及用于错误检测和校正的信息。
通常将扇区交错摆放使得读取时更加及时。

5.4.2磁臂调度算法
读写磁盘时间 = 寻道时间 + 旋转延时（平均为二分之一圈） + 实际传输时间

调度算法
	FCFS先来先服务
	SSTF最短寻到距离优先（找到队列里距离当前位置最短的）
	SCAN扫描算法（扫描到两边尽头）
	LOOK查看算法（只扫描到两边最大最小的磁道，不到尽头）
	C-SCAN循环扫描（每次从最左边到最右边 到最右边快速返回最左边）
	C-LOOK循环查看（不到尽头）
	
